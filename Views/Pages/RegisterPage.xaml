<?xml version="1.0" encoding="utf-8" ?>
<local:DisposableContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:FlockForge.Controls"
             xmlns:vm="clr-namespace:FlockForge.ViewModels.Pages"
             xmlns:local="clr-namespace:FlockForge.Views.Base"
             x:Class="FlockForge.Views.Pages.RegisterPage"
             x:DataType="vm:RegisterViewModel"
             Title="Create Account">
    <Grid Style="{StaticResource GF.Grid}">
        <ScrollView>
            <VerticalStackLayout
                Padding="0"
                Spacing="{DynamicResource GF.Spacing}"
                VerticalOptions="Start">

                <!-- App Logo -->
                <Image
                    Source="flockforge_logo.png"
                    HeightRequest="100"
                    WidthRequest="100"
                    HorizontalOptions="Center"
                    Margin="0,0,0,20"/>

                <!-- Welcome Message -->
                <Label
                    Text="Create Your Account"
                    FontSize="24"
                    Style="{StaticResource GF.LabelBase}"
                    HorizontalOptions="Center"
                    HorizontalTextAlignment="Center"
                    Margin="0,0,0,10"/>

                <Label
                    Text="Join FlockForge to manage your flock"
                    FontSize="16"
                    TextColor="Gray"
                    Style="{StaticResource GF.LabelBase}"
                    HorizontalOptions="Center"
                    HorizontalTextAlignment="Center"
                    Margin="0,0,0,30"/>

                <!-- Display Name Input -->
                <Entry
                    Style="{StaticResource GF.Entry}"
                    Text="{Binding DisplayName}"
                    Placeholder="Display Name"
                    ReturnType="Next"
                    SemanticProperties.Description="Enter display name"/>

                <!-- Email Input -->
                <Entry
                    Style="{StaticResource GF.Entry}"
                    Text="{Binding Email}"
                    Placeholder="Email"
                    Keyboard="Email"
                    ReturnType="Next"
                    SemanticProperties.Description="Enter email address"/>

                <!-- Password Input with AutoFill protection -->
                <controls:SecurePasswordEntry
                    Style="{StaticResource GF.Entry}"
                    Text="{Binding Password}"
                    Placeholder="Password (min 6 characters)"
                    ReturnType="Next"
                    SemanticProperties.Description="Enter password"/>

                <!-- Confirm Password Input with AutoFill protection -->
                <controls:SecurePasswordEntry
                    Style="{StaticResource GF.Entry}"
                    Text="{Binding ConfirmPassword}"
                    Placeholder="Confirm Password"
                    ReturnType="Done"
                    SemanticProperties.Description="Re-enter password for confirmation"/>

                <!-- Error Message -->
                <Label
                    Text="{Binding ErrorMessage}"
                    TextColor="Red"
                    IsVisible="{Binding HasError}"
                    HorizontalOptions="Center"
                    HorizontalTextAlignment="Center"
                    Margin="0,10,0,10"/>

                <!-- Add spacing before button to prevent AutoFill overlay -->
                <BoxView HeightRequest="20" Color="Transparent"/>

                <!-- Register Button -->
                <Button
                    Text="Create Account"
                    Command="{Binding RegisterCommand}"
                    Style="{StaticResource GF.ButtonBase}"
                    SemanticProperties.Description="Submit registration"/>

                <!-- Cancel Button -->
                <Button
                    Text="Cancel"
                    Command="{Binding CancelCommand}"
                    Style="{StaticResource GF.ButtonBase}"
                    BackgroundColor="Transparent"
                    SemanticProperties.Description="Cancel registration"/>

                <!-- Busy Indicator -->
                <StackLayout
                    IsVisible="{Binding IsBusy}"
                    Orientation="Horizontal"
                    HorizontalOptions="Center"
                    Spacing="10"
                    Margin="0,20,0,20">
                    <ActivityIndicator
                        IsRunning="{Binding IsBusy}"
                        Color="#512BD4"/>
                    <Label Text="{Binding BusyMessage}"
                       IsVisible="{Binding IsBusy}"
                       HorizontalOptions="Center" />
                </StackLayout>

                <!-- Bottom padding to ensure scrollability -->
                <BoxView HeightRequest="50" Color="Transparent"/>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</local:DisposableContentPage>